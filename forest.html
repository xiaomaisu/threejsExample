<html>
<head>
	<title>森林 3D</title>
	<style>
	body {
		margin: 0;
	}
	canvas {
		width: 100%;
		height: 100%
	}
	</style>
</head>
<body>
	<script src="https://threejs.org/build/three.min.js"></script>
	<script src="../three.js/examples/js/loaders/OBJLoader.js"></script>
	<script type="x-shader/x-vertex" id="vertexShader">
      varying vec3 vWorldPosition;
   
      void main(void) {
      	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
		vWorldPosition = worldPosition.xyz;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      }
    </script>
    <script type="x-shader/x-fragment" id="fragmentShader">
    	uniform vec3 topColor;
    	uniform vec3 bottomColor;

    	uniform float offset;
		uniform float exponent;

		varying vec3 vWorldPosition;
    	
      	void main(void) {
			float h = normalize( vWorldPosition + offset ).y;
			gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
      	}
    </script>
	<script>
	//场景
	var scene,camera,renderer;
	function init() {
		// body...
		createScene();
		createLights();
		createSky();
		createTree();
		//createGugu();
		//createAvatar();
		createHome();
		//renderer.render(scene,camera);
	}
	//照相机
	function createScene() {
		// body...
		scene = new THREE.Scene();
		scene.fog = new THREE.Fog( 0xffffff, 1, 5000 );
		scene.fog.color.setHSL( 0.6, 0, 1 );
		//照相机
		camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
		camera.position.set( 0, 0, 250 );
		//renderer
		renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
	}
	function handleWindowResize() {
		HEIGHT = window.innerHeight;
		WIDTH = window.innerWidth;
		renderer.setSize(WIDTH, HEIGHT);
		camera.aspect = WIDTH / HEIGHT;
		camera.updateProjectionMatrix();
	}
	var ambientLight, hemisphereLight, shadowLight;

	function createLights() {
	
	  hemisphereLight = new THREE.HemisphereLight(0xaaaaaa,0x000000, .6)
	  shadowLight = new THREE.DirectionalLight(0xffffff, .9);
	  shadowLight.position.set(150, 350, 350);
	  shadowLight.castShadow = true;
	  shadowLight.shadow.camera.left = -400;
	  shadowLight.shadow.camera.right = 400;
	  shadowLight.shadow.camera.top = 400;
	  shadowLight.shadow.camera.bottom = -400;
	  shadowLight.shadow.camera.near = 1;
	  shadowLight.shadow.camera.far = 1000;
	  shadowLight.shadow.mapSize.width = 2048;
	  shadowLight.shadow.mapSize.height = 2048;
	
	  scene.add(hemisphereLight);
	  scene.add(shadowLight);
	}

	function createSky() {
		var vertexShader = document.getElementById( 'vertexShader' ).textContent;
		var fragmentShader = document.getElementById('fragmentShader' ).textContent;
		var uniforms = {
			topColor:    { value: new THREE.Color( 0xe8ded4 ) },
			bottomColor: { value: new THREE.Color( 0xfbf2e9 )},
			offset:      { value: 33 },
			exponent:    { value: 0.6 }
		}
		var groundUniforms = {
			topColor:    { value: new THREE.Color( 0xfbf2e9 ) },
			bottomColor: { value: new THREE.Color( 0xddd3c9 )},
			offset:      { value: 33 },
			exponent:    { value: 0.6 }
		}
		var skyGeo = new THREE.SphereGeometry( 400, 32, 15 );
		var skyMat = new THREE.ShaderMaterial( { vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms, side: THREE.BackSide } );
		var sky = new THREE.Mesh( skyGeo, skyMat );
		scene.add( sky );

		var groundGeo = new THREE.PlaneBufferGeometry( 10000, 10000 );
		var groundMat = new THREE.ShaderMaterial( { vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: groundUniforms, side: THREE.BackSide } );
		// groundMat.receiveShadow = true;
		var ground = new THREE.Mesh( groundGeo, groundMat );
		ground.rotation.x = -Math.PI/2;
		ground.position.y = -33;
		ground.receiveShadow = true;
		scene.add( ground );
		ground.receiveShadow = true;
	}

	function createTree() {
		// body...
		var geometry = new THREE.ConeGeometry( 20,30,5);
		var mediumgGometry = new THREE.ConeGeometry( 30,30,5);
		var biggGometry = new THREE.ConeGeometry( 40,30,5);
		var material = new THREE.MeshLambertMaterial( {color: 0xc0c739} );
		material.castShadow = true;
		var cone = new THREE.Mesh( geometry, material );
		var mediumCone = new THREE.Mesh(mediumgGometry, material );
		var bigCone = new THREE.Mesh(biggGometry, material );
		cone.rotation.z = Math.PI/20;
		mediumCone.position.y = -20;
		bigCone.position.y = -40;
		cone.castShadow = true;
		mediumCone.castShadow = true;
		bigCone.castShadow = true;
		scene.add( cone );
		scene.add( mediumCone );
		scene.add( bigCone );

		var stumpGeometry = new THREE.CylinderGeometry( 2, 8, 15, 32 );
		var stumpMaterial = new THREE.MeshLambertMaterial( {color: 0x6e4f32} );
		//stumpMaterial.castShadow = true;
		var stump = new THREE.Mesh( stumpGeometry, stumpMaterial );
		stump.position.y = -70;
		stump.castShadow = true;
		stump.receiveShadow = true;
		scene.add( stump );
	}
	function createGugu() {
		var loader = new THREE.OBJLoader();
		loader.load(
			// resource URL
			'model/gugu.obj',
			// Function when resource is loaded
			function ( object ) {
				console.log(object)
				object.scale.set(100,100,100);
				scene.add( object );
			}
		);
	}
	function createAvatar() {
		var loader = new THREE.JSONLoader();
		loader.load(
			// resource URL
			'model/model-threejs.json',
			// Function when resource is loaded
			function ( geometry,materials ) {
				var material = materials[ 0 ];
				var object = new THREE.Mesh( geometry, material );
				scene.add( object );
			}
		);
	}
	function createHome() {
		var loader = new THREE.OBJLoader();
		loader.load(
			// resource URL
			'model/male02.obj',
			// Function when resource is loaded
			function ( male ) {
				male.position.y = -100;
				male.scale.set(1000,1000,1000);
				// scene.add( hemisphereLight );
				// scene.add(bigCone)
				scene.add(male)
				// var stump1 = stump.clone();
				// stump1.position.y = -100
				// scene.add(stump1)
				// console.log(scene)
			}
		);
	}
	function animate() {
		requestAnimationFrame( animate );
		render();
	}
	function render() {
		renderer.render( scene, camera );
	}
	window.onload=function(){init(); animate();};
	</script>
</body>