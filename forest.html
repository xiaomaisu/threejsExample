<html>
<head>
	<title>森林 3D</title>
	<style>
	body {
		margin: 0;
	}
	canvas {
		width: 100%;
		height: 100%
	}
	</style>
</head>
<body>
	<script src="https://threejs.org/build/three.min.js"></script>
	<script type="x-shader/x-vertex" id="vertexShader">
      attribute vec3 aVertexPosition;
      varying vec3 vWorldPosition;
    
      uniform mat4 uMVMatrix;
      uniform mat4 uPMatrix;
    
      void main(void) {
      	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
		vWorldPosition = worldPosition.xyz;
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
      }
    </script>
    <script type="x-shader/x-fragment" id="fragmentShader">
    	uniform vec3 topColor;
    	uniform vec3 bottomColor;

    	uniform float offset;
		uniform float exponent;

		varying vec3 vWorldPosition;
    	
      void main(void) {
		float h = normalize( vWorldPosition + offset ).y;
		gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0), exponent ), 0.0 ) ), 1.0 );
      }
    </script>
	<script>
	//场景
	var scene,camera,renderer;
	function init() {
		// body...
		createScene();
		createLights();
		createSky();
		renderer.render(scene,camera);
	}
	//照相机
	function createScene() {
		// body...
		scene = new THREE.Scene();
		scene.fog = new THREE.Fog( 0xffffff, 1, 5000 );
		scene.fog.color.setHSL( 0.6, 0, 1 );
		//照相机
		camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
		camera.position.set( 0, 0, 250 );
		//renderer
		renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
	}
	function handleWindowResize() {
		HEIGHT = window.innerHeight;
		WIDTH = window.innerWidth;
		renderer.setSize(WIDTH, HEIGHT);
		camera.aspect = WIDTH / HEIGHT;
		camera.updateProjectionMatrix();
	}
	var ambientLight, hemisphereLight, shadowLight;

	function createLights() {
	
	  hemisphereLight = new THREE.HemisphereLight(0xaaaaaa,0x000000, .6)
	  shadowLight = new THREE.DirectionalLight(0xffffff, .9);
	  shadowLight.position.set(150, 350, 350);
	  shadowLight.castShadow = true;
	  shadowLight.shadow.camera.left = -400;
	  shadowLight.shadow.camera.right = 400;
	  shadowLight.shadow.camera.top = 400;
	  shadowLight.shadow.camera.bottom = -400;
	  shadowLight.shadow.camera.near = 1;
	  shadowLight.shadow.camera.far = 1000;
	  shadowLight.shadow.mapSize.width = 2048;
	  shadowLight.shadow.mapSize.height = 2048;
	
	  scene.add(hemisphereLight);
	  scene.add(shadowLight);
	}

	function createSky() {

		// GROUND
		var groundGeo = new THREE.PlaneBufferGeometry( 10000, 10000 );

		var canvas = document.getElementsByTagName('canvas')[0];
		var ctx = canvas.getContext('webgl');
		// var gradient = ctx.createLinearGradient(0,500,0,2000);
		// gradient.addColorStop(0,'#f9f0e7');
		// gradient.addColorStop(1,'#dbd1c7');
		var groundMat = new THREE.MeshPhongMaterial( { color: '#dbd1c7',shading: THREE.FlatShading} );
		//groundMat.color.setHSL( .27, .1, 0.85 );
		var ground = new THREE.Mesh( groundGeo, groundMat );
		ground.rotation.x = -Math.PI/2;
		ground.position.y = -33;
		scene.add( ground );
		ground.receiveShadow = true;


		var vertexShader = document.getElementById( 'vertexShader' ).textContent;
		var fragmentShader = document.getElementById( 'fragmentShader' ).textContent;
		var uniforms = {
			topColor:    { value: new THREE.Color( 0x0077ff ) },
			bottomColor: { value: new THREE.Color( 0xe82626 )},
			offset:      { value: 33 },
			exponent:    { value: 0.6 }
		}
		var skyGeo = new THREE.CubeGeometry( 4000, 32, 15 );
		var skyMat = new THREE.ShaderMaterial( { vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms, side: THREE.BackSide } );
		//var skyMat = new THREE.MeshPhongMaterial( { color: '#ff3520'} );
		var sky = new THREE.Mesh( skyGeo, skyMat );
		sky.position.y = -500;
		scene.add( sky );
	}
	window.onload=init;
	</script>
</body>